---
# roles/configure_windows_clients/tasks/main.yml

- name: "Clientes Windows | Establecer el plan de energía a 'Alto rendimiento'"
  ansible.windows.win_shell: powercfg -setactive SCHEME_MIN
  changed_when: false # El comando no reporta "cambio", así que lo forzamos
  tags:
    - optimizacion

- name: "Clientes Windows | Deshabilitar la hibernación (libera espacio)"
  ansible.windows.win_shell: powercfg.exe /hibernate off
  changed_when: false
  tags:
    - optimizacion

- name: "Clientes Windows | Confirmar software pre-instalado"
  ansible.builtin.debug:
    msg: "Este cliente Windows está listo. El software (Steam, Epic) fue pre-instalado en la VM Maestra."
  tags:
    - always
    
- name: "Clientes Windows | Crear tarea programada para iniciar servidor CS 1.6"
  ansible.windows.win_scheduled_task:
    name: "Servidor Dedicado CS 1.6"
    description: "Inicia el servidor HLDS (CS 1.6) automáticamente al arrancar"
    actions:
      - path: 'C:\Program Files (x86)\Counter-Strike 1.6\hlds.exe'
        arguments: "-game cstrike +sv_lan 1 +map de_dust2 +maxplayers 16 -nomaster -insecure -console"
    triggers:
      - type: at_startup
    settings:
      run_level: highest
      stop_if_going_on_batteries: false
      disallow_start_if_on_batteries: false
    state: present