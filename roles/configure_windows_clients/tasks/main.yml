---
# roles/configure_windows_clients/tasks/main.yml

- name: "Clientes Windows | Establecer el plan de energía a 'Alto rendimiento'"
  ansible.windows.win_shell: powercfg -setactive SCHEME_MIN
  changed_when: false # El comando no reporta "cambio", así que lo forzamos
  tags:
    - optimizacion

- name: "Clientes Windows | Deshabilitar la hibernación (libera espacio)"
  ansible.windows.win_shell: powercfg.exe /hibernate off
  changed_when: false
  tags:
    - optimizacion

- name: "Clientes Windows | Crear e iniciar el servicio para el servidor de CS 1.6"
  ansible.windows.win_service:
    name: "CS16_Server_UPeU"
    display_name: "CS 1.6 Dedicated Server (LAN)"
    description: "Inicia el servidor HLDS para el Game Center"
    # Corregido: Encapsulamos el ejecutable y argumentos en cmd.exe /c
    path: 'C:\Windows\System32\cmd.exe /c "C:\Program Files (x86)\Counter-Strike 1.6\hlds.exe -game cstrike +sv_lan 1 +map de_dust2 +maxplayers 16 -nomaster -insecure -console"'
    start_mode: auto
    state: started # <-- Esto asegura que el servicio se crea Y se inicia.

- name: "Clientes Windows | Iniciar el servicio del servidor de CS 1.6"
  ansible.windows.win_service:
    name: "CS16_Server_UPeU"
    state: started