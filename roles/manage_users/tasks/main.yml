---
- name: Gestionar cuentas de usuario
  ansible.builtin.user:
    name: "{{ item.name }}"
    state: "{{ item.state | default('present') }}"
    groups: "{{ item.groups | default(omit) }}"
    append: yes
  loop: "{{ users_to_manage }}"

- name: Permitir al grupo 'wheel' ejecutar comandos con sudo sin contrase√±a
  ansible.builtin.lineinfile:
    path: /etc/sudoers.d/90-wheel-nopasswd
    line: '%wheel ALL=(ALL) NOPASSWD: ALL'
    create: yes
    owner: root
    group: root
    mode: '0440'
    validate: 'visudo -cf %s'